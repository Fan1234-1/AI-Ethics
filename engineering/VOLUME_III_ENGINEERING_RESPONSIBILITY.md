# VOLUME III — ENGINEERING RESPONSIBILITY

## 1. 前言

語魂系統的核心價值之一是責任與承擔。工程實作需要將倫理責任具體化，並在程式碼與流程中反映出決策與交付的責任歸屬。本卷冊將介紹 Command/Query 責任分離（CQRS）的應用、原子檢查器、以及 Trust Pack 的規範。

## 2. CQRS 與責任分離

在領域模型設計中，我們使用 CQRS 將操作分為 **Command**（寫入）與 **Query**（讀取）兩個通道：

| 操作類型 | 描述                            | 責任點                                   |
|-----------|---------------------------------|------------------------------------------|
| Command   | 產生事件並改變系統狀態          | 必須檢查輸入完整性、記錄決策原因、推算對應向量；每筆修改需寫入 StepLedger。 |
| Query     | 讀取狀態或計算衍生資訊          | 不改變狀態，僅根據投影或快照回傳；必須遵守資料安全與隱私規範。 |

將讀寫分離有助於明確追蹤責任：每個 Command 都可以回溯到其發起者與影響範圍，而 Query 則提供安全的讀取介面。

## 3. 原子檢查器（Checkers）

為了確保每個輸出都符合語魂系統的價值觀，我們使用一系列原子檢查器來驗證輸出內容。常用檢查器包括：

| 檢查器        | 作用                                                |
|---------------|-----------------------------------------------------|
| **Align**     | 檢查輸出是否與用戶意圖或任務描述對齊，防止語義漂移。 |
| **Borrow**    | 檢查引用或借用外部資料的合法性與授權範圍。             |
| **Digitwise** | 檢查數值計算、指標處理的準確性。                       |
| **BackSub**   | 檢查回答是否可被逆推而暴露敏感資料或內部推理。         |
| **Dependency**| 檢查依賴或引用的模組是否穩定且授權正確。               |
| **Semantic**  | 檢查用語是否尊重多元、避免歧視或偏見。                 |
| **Boundary**  | 檢查輸出是否超出系統預設的邊界條件；若超出則警告或調整。|

檢查器通常在 Command 流程中串聯，當任一檢查失敗時，可回傳替代方案或要求人工介入。

## 4. Trust Pack（交付規約）

Trust Pack 定義了系統交付回答時需包含的資訊與格式，用以建立使用者信任與可追溯性，包含：

1. **推理鏈與邊界**：簡述主要推理步驟、假設與邊界條件，若推理涉及外部依賴需註明來源。
2. **責任人與版本**：標示產生本回答的模型版本、檢查器版本與負責審核的模組或團隊。
3. **撤回條件**：列出可能導致回答失效的情況，例如新的資料、規則更新或輸入條件變動，並提供撤回或更新機制。
4. **POAV 報告**：若回答涉及重要決策或爭議議題，應附上 POAV 0.9 模式報告，列出至少兩種方案、取捨理由與邊界。

範例格式（JSON）：

```json
{
  "answer": "具體回答內容……",
  "reasoning": "主要推理步驟與假設說明……",
  "modelVersion": "v2.3.1",
  "checkers": ["Align", "Digitwise", "Boundary"],
  "revocation": "當資料集更新至 2025-09 版本後需重新評估。",
  "poavReport": {
    "options": ["方案 A", "方案 B"],
    "prosCons": ["A: 更安全但回應時間長", "B: 回應快但風險稍高"],
    "boundaries": ["適用於語料長度 < 1000 tokens", "涉及個人敏感資訊時不適用"]
  }
}
```

## 5. 審計與版本控制

所有責任相關模組與檢查器應實施版本控制，以便追蹤規則更新。建議在 StepLedger 事件中存儲以下欄位：

```yaml
AuditInfo:
  checker_versions: map[string, string]  # 各檢查器版本
  poav_version: string                   # 使用的 POAV 模式版本
  timestamp: datetime                    # 產生回覆的時間
  annotations: string                    # 其他註解，如人工審核人員
```

## 6. 小結

本卷冊聚焦於責任落地的實作，透過 CQRS、原子檢查器與 Trust Pack 規約，使語魂系統的每個回答都可追溯、可審計且合乎倫理。下一卷將說明系統的演化機制與擴充策略，確保系統在面對新需求與環境變遷時能持續成長。